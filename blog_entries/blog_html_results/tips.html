
          <!DOCTYPE html>
          <html lang="en">

          <head>

                <meta charset="UTF-8">
                <meta http-equiv="X-UA-Compatible">
                <meta name="description" content="None">
                <meta name="keywords" content="tips, git, sql, python">
                <meta name="author" content="Leopoldo Cuspinera">
                <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
                <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

                <title>Tips</title>
                <link rel="icon" type="image/x-icon" href="../../images/favicon.ico">
                <link rel="stylesheet" href="../../css/bootstrap.min.css">
                <link rel="stylesheet" href="../../css/font-awesome.min.css">

                <!-- Main css -->
                <link rel="stylesheet" href="../../css/style.css">
                <link href="https://fonts.googleapis.com/css?family=Lora|Merriweather:300,400" rel="stylesheet">
                
                <!-- Color code cells -->
                <link href="../../css/markdown_pygments.css" rel="stylesheet">

                <style>.main-single-post {background: url('../../images/my_pictures/blackboard_PI.jpg') no-repeat;}</style>
                <style>
                    h1 {
                        font-size: 30px;
                    }
                    
                    h2 {
                        font-size: 24px;
                    }
                    
                    h3 {
                        font-size: 20px;
                    }
                </style>
                
               
                
          </head>

          <body>

               <!-- Navigation section  -->

               <div class="navbar navbar-default navbar-static-top" role="navigation">
                    <div class="container">

                         <div class="navbar-header">
                              <button class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                                   <span class="icon icon-bar"></span>
                                   <span class="icon icon-bar"></span>
                                   <span class="icon icon-bar"></span>
                              </button>
                              <a href="../../index.html" class="navbar-brand">Leopoldo Cuspinera</a>
                         </div>
                         <div class="collapse navbar-collapse">
                              <ul class="nav navbar-nav navbar-right">
                                   <li><a href="../../index.html">Home</a></li>
                                   <li><a href="../../about.html">About</a></li>
                                   <li><a href="../../gallery.html">Gallery</a></li>
                                   <li><a href="../../blog.html">Blog</a></li>
                                   <li><a href="../../contact.html">Contact</a></li>
                              </ul>
                         </div>

                    </div>
               </div>

               <!-- Main title of blog section -->

               <section id="home" class="main-single-post parallax-section">
                    <div class="overlay"></div>
                    <div class="container">
                         <div class="row">

                              <div class="col-md-12 col-sm-12">
                                   <h1 style="font-size:50px;">Tips</h1>
                              </div>

                         </div>
                    </div>
               </section>

               <!-- Blog Single Post Section -->

               <section id="blog-single-post">
                    <div class="container">
                         <div class="row">

                              <div class="col-md-offset-1 col-md-10 col-sm-12">
                                   <div class="blog-single-post-thumb">


                                        <div class="blog-post-title">
                                             
                                        </div>

                                        

                                        <div class="blog-markdown">
                                        <ul>
<li><a href="#git-commands">Git commands</a><ul>
<li><a href="#important">Important</a></li>
<li><a href="#less-important">Less important</a></li>
<li><a href="#take-it-back-commands">Take-it-back commands</a></li>
<li><a href="#pre-commit">Pre-commit</a></li>
</ul>
</li>
<li><a href="#python">Python</a><ul>
<li><a href="#forcing-python-to-reimport-a-library">Forcing python to reimport a library</a></li>
</ul>
</li>
<li><a href="#pyspark">Pyspark</a><ul>
<li><a href="#time-sliding-windows">Time sliding windows</a></li>
<li><a href="#flattening-nested-dataframes">Flattening nested dataframes</a></li>
</ul>
</li>
<li><a href="#plots">Plots</a><ul>
<li><a href="#gantt">Gantt</a></li>
<li><a href="#time-series-quick-decomposition">Time Series quick decomposition</a></li>
<li><a href="#pareto">Pareto</a></li>
</ul>
</li>
<li><a href="#maps">Maps</a></li>
<li><a href="#other-resources">Other resources</a></li>
</ul>
<h1 id="description">Description</h1>
<p>This is a blog entry that I will use to share some things I have found to be useful but that do not really require a lengthy specified blog entry.</p>
<p>I think of it as a <strong>notes to self</strong> section of my website.</p>
<hr />
<h1 id="git-commands">Git commands</h1>
<p>Many of these commands can be found <a href="https://www.atlassian.com/git/tutorials/atlassian-git-cheatsheet">in this website</a></p>
<h2 id="important">Important</h2>
<ul>
<li><strong>git branch</strong>  list all the branches in my local repo  </li>
<li><strong>git branch new_branch</strong>  Creates a branch named <strong>new_branch</strong>  </li>
<li><strong>git branch -d localBranchName</strong>  Delete branch locally  </li>
<li><strong>git checkout -b some_branch</strong>  Create and check out a new branch named <strong>some_branch</strong>. If we drop the <strong>-b</strong> we can only   checkout an existing branch</li>
<li><strong>git pull</strong>  fetch the specified remote's copy of current branch and merge it into the local copy  </li>
<li><strong>git add file1 file2</strong>  adds file1 and file 2 to the algorithm that keeps track of changes in the next commit.  </li>
<li><strong>git commit -m 'short message' -m 'more descriptive message'</strong>  creates a commit with the changes we have made and some   comments about what we did</li>
<li><strong>git push</strong>  push the branch to be merged  </li>
</ul>
<h2 id="less-important">Less important</h2>
<ul>
<li><strong>git --version</strong> </li>
<li><strong>git status</strong></li>
<li><strong>git log</strong> shows the entire commit history </li>
<li><strong>git diff</strong> shows differences between the branch and the working directory.</li>
<li><strong>git clone URL_of_repo</strong></li>
</ul>
<h2 id="take-it-back-commands">Take-it-back commands</h2>
<p>If we messed something up, we can try and revert the changes:</p>
<ul>
<li><strong>git revert commit_key</strong> undoes all the changes made in commit and applies it to the current branch</li>
<li><strong>git reset file1</strong> remove file1 from the staging area but leaves working directory unchanged</li>
<li><strong>git reset --hard HEAD</strong> resets to last valid commit</li>
<li><strong>git log</strong> see history</li>
</ul>
<p>To get single files or folders from a branch (in case we accidentally deleted a file or something like that) we can use:</p>
<div class="codehilite"><pre><span></span><code>git fetch --all
git checkout origin/master -- &lt;your_file_path&gt;
git add &lt;your_file_path&gt;
git commit -m <span class="s2">&quot;&lt;your_file_name&gt; updated&quot;</span>
</code></pre></div>

<h2 id="pre-commit">Pre-commit</h2>
<p>Arguably, one of the tools that helps the most when coding within a team is to make use of automatic tests and/or quick
style fixes to our code. A quick example: spotting and fixing <code>trailing white spaces</code> manually
(who has time for that???). The tool to use in this case is <a href="https://pre-commit.com/">pre-commit</a>, which is run when you launch a <code>git commit</code> command and prevents you from making a commit or fixes your files if one of your predefined hooks fails.</p>
<p>After installing pre-commit via <code>pip install pre-commit</code> you can run </p>
<div class="codehilite"><pre><span></span><code>pre-commit sample-config
</code></pre></div>

<p>to create a basic first configuration file: <code>.pre-commit-config.yaml</code>. This yaml file will consist of a couple of sources (<em>repo</em>) with corresponding versions (<em>rev</em>) and a series of hooks to be used (<em>hook</em> and a list of identifiers <em>id</em>).
The file looks like:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/pre-commit/pre-commit-hooks</span><span class="w"></span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2.3.0</span><span class="w"></span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check-yaml</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">end-of-file-fixer</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trailing-whitespace</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/psf/black</span><span class="w"></span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22.10.0</span><span class="w"></span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">black</span><span class="w"></span>
</code></pre></div>

<p>Which you can modify to your convenience. For instance, you may want to run some hooks with specific arguments or explicitly skip a given file for some particular hook:</p>
<div class="codehilite"><pre><span></span><code><span class="nt">repos</span><span class="p">:</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/pre-commit/pre-commit-hooks</span><span class="w"></span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2.3.0</span><span class="w"></span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trailing-whitespace</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">check-added-large-files</span><span class="w"></span>
<span class="w">        </span><span class="nt">args</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;--maxkb=1024&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<span class="w">        </span><span class="nt">exclude</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;notebooks/some_jupyter_notebook.ipynb,</span><span class="nv"> </span><span class="s">some_data.csv&quot;</span><span class="w"></span>
<span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">repo</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/psf/black</span><span class="w"></span>
<span class="w">    </span><span class="nt">rev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22.10.0</span><span class="w"></span>
<span class="w">    </span><span class="nt">hooks</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w">   </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">black</span><span class="w"></span>
<span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">args:[&#39;--line-length=100&#39;]</span><span class="w"></span>
</code></pre></div>

<p>Now that you have a yaml you want to work with, you can install the pre-commit hooks:</p>
<div class="codehilite"><pre><span></span><code>pre-commit install
</code></pre></div>

<p>Now, even though these hooks are supposed to run right before the commit in an automated way, it is nice to be able to run them directly as a sanity check when you are fixing some of the issues you have:</p>
<div class="codehilite"><pre><span></span><code>pre-commit run --all-files
pre-commit run &lt;ONE_FILE_NAME&gt; <span class="c1"># to run hooks on just one specific file</span>
</code></pre></div>

<p>It is very importatn that if one of your files fails to pass one of the hooks you'll need to tell git you want to add the modified version that will now pass the check, otherwise you will never be able to actually commit and push (unless you want to skip the pre-commit hooks verification via <code>git commit -m &lt;MESSAGE&gt; --no-verify</code> which is not recommended).</p>
<div class="codehilite"><pre><span></span><code>git add &lt;MODIFIED_FILE_NAME&gt;
git add commit -m &lt;MESSAGE&gt;
</code></pre></div>

<hr />
<h1 id="python">Python</h1>
<h2 id="forcing-python-to-reimport-a-library">Forcing python to reimport a library</h2>
<p>When using jupyter notebooks, IPython optimizes the amount of imports by disregarding those that have been already imported and saved on memory.
This is of course counterproductive when you are trying to have a utils file to create clean jupyter notebooks for presentation purposes that have a lot of code behind. 
Saving the python file you're working on and rerunning the jupyter cell containing the import won't be enough.</p>
<p>However, you can enforce the reload of functions <code>f, g, h</code> from library <code>X</code> with:</p>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">reload</span>
<span class="kn">import</span> <span class="nn">X</span>
<span class="kn">from</span> <span class="nn">X</span> <span class="kn">import</span> <span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>

<span class="n">reload</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</code></pre></div>

<hr />
<h1 id="pyspark">Pyspark</h1>
<h2 id="time-sliding-windows">Time sliding windows</h2>
<div class="codehilite"><pre><span></span><code><span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">functions</span> <span class="k">as</span> <span class="n">F</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.window</span> <span class="kn">import</span> <span class="n">Window</span>


<span class="k">def</span> <span class="nf">lagged_window</span><span class="p">(</span>
    <span class="n">window_partition_columns</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">time_column</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">window_size</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">lagging_days</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mi">0</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This function creates a sliding window of constant width from a date column based on a single time column</span>

<span class="sd">    Args:</span>
<span class="sd">        window_partition_columns (list of str): Names of the columns to be used as partition.</span>
<span class="sd">            These columns &quot;reset&quot; the windowing function.</span>
<span class="sd">        time_column (str): Column with the date or timestamp to be used to order the rows for the windowing function</span>
<span class="sd">        window_size (int or float): number of days or portion of a day to be used as interval for the window size.</span>
<span class="sd">            This will be rounded to integer seconds. Defaults to 7.</span>
<span class="sd">        lagging_days (int or float): number of days to shift the windowing function. Defaults to 0</span>

<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.window.Window</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">days_to_s</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

    <span class="n">win</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">window_partition_columns</span><span class="p">)</span>
        <span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">time_column</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="s2">&quot;long&quot;</span><span class="p">))</span>
        <span class="o">.</span><span class="n">rangeBetween</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">days_to_s</span><span class="p">(</span><span class="n">window_size</span> <span class="o">+</span> <span class="n">lagging_days</span><span class="p">)),</span> <span class="o">-</span><span class="n">days_to_s</span><span class="p">(</span><span class="n">lagging_days</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">win</span>

<span class="c1"># Example</span>
<span class="n">part_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;shop&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;customer&#39;</span><span class="p">,</span> <span class="s1">&#39;device&#39;</span><span class="p">]</span>
<span class="n">lag_window</span> <span class="o">=</span> <span class="n">Window</span><span class="o">.</span><span class="n">partitionBy</span><span class="p">(</span><span class="n">part_cols</span><span class="p">)</span><span class="o">.</span><span class="n">orderBy</span><span class="p">(</span><span class="s1">&#39;time_column&#39;</span><span class="p">)</span>

<span class="n">df_with_moving_average</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;col_1D_MA&#39;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s1">&#39;col&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">lagged_window</span><span class="p">(</span><span class="n">part_cols</span><span class="p">,</span> <span class="s1">&#39;time_column&#39;</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
    <span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s1">&#39;col_30m_MA&#39;</span><span class="p">,</span> <span class="n">F</span><span class="o">.</span><span class="n">avg</span><span class="p">(</span><span class="s1">&#39;col&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="n">lagged_window</span><span class="p">(</span><span class="n">part_cols</span><span class="p">,</span> <span class="s1">&#39;time_column&#39;</span><span class="p">,</span> <span class="n">window_size</span><span class="o">=</span><span class="p">(</span><span class="mf">.5</span><span class="o">/</span><span class="mi">24</span><span class="p">))))</span>
<span class="p">)</span>
</code></pre></div>

<h2 id="flattening-nested-dataframes">Flattening nested dataframes</h2>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">flatten_df</span><span class="p">(</span><span class="n">nested_df</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Flatten a spark dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        nested_df (pyspark.sql.dataframe.DataFrame): dataframe with possible struct-type columns</span>

<span class="sd">    Returns:</span>
<span class="sd">        pyspark.sql.dataframe.DataFrame with a column per &#39;key&#39; of the nested_df struct-type columns</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">flat_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nested_df</span><span class="o">.</span><span class="n">dtypes</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">6</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;struct&#39;</span><span class="p">]</span>
    <span class="n">nested_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nested_df</span><span class="o">.</span><span class="n">dtypes</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;struct&#39;</span><span class="p">]</span>

    <span class="n">flat_df</span> <span class="o">=</span> <span class="n">nested_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">flat_cols</span> <span class="o">+</span>
                               <span class="p">[</span><span class="n">F</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="n">nc</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="n">nc</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
                                <span class="k">for</span> <span class="n">nc</span> <span class="ow">in</span> <span class="n">nested_cols</span>
                                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">nested_df</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">nc</span><span class="o">+</span><span class="s1">&#39;.*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">flat_df</span>
</code></pre></div>

<hr />
<h1 id="plots">Plots</h1>
<h2 id="gantt">Gantt</h2>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">gantt_chart</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">tasks_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">initial_time_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_time_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">color_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Gantt plot that shows where each individual task starts and ends.</span>
<span class="sd">    Each task can have multiple time intervals</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): pandas dataframe with </span>
<span class="sd">        tasks_column (str): name of the column containing categorical data</span>
<span class="sd">        initial_time_column (str): start time of task interval</span>
<span class="sd">        end_time_column (str): end time of task interval</span>
<span class="sd">        color_dict (dict, optional): colors assigned to each task interval. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        plt.Figure: Gantt plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">color_dict</span><span class="p">:</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="n">color_dict</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cd</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">tasks_column</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="n">cd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="s2">&quot;0123456789ABCDEF&quot;</span><span class="p">)])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="c1"># Plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="n">tasks_column</span><span class="p">],</span>
        <span class="n">df</span><span class="p">[</span><span class="n">end_time_column</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="n">initial_time_column</span><span class="p">],</span>
        <span class="n">left</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">initial_time_column</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">tasks_column</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">cd</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span>
        <span class="n">height</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Axes formatting</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">mdates</span><span class="o">.</span><span class="n">MonthLocator</span><span class="p">(</span><span class="n">bymonthday</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">autofmt_xdate</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div>

<h2 id="time-series-quick-decomposition">Time Series quick decomposition</h2>
<p>Hopefullly a time saver when we just want to see quickly some characteristics of a time series.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.seasonal</span> <span class="kn">import</span> <span class="n">seasonal_decompose</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span>
<span class="kn">from</span> <span class="nn">plotly.subplots</span> <span class="kn">import</span> <span class="n">make_subplots</span>


<span class="k">def</span> <span class="nf">plot_time_series_decomposition</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">value_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">time_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;multiplicative&quot;</span><span class="p">,</span>
    <span class="n">show_autocorrelation_plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">lags_for_acf</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Show the time series decomposition of a time series pandas dataframe</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): pandas dataframe to try and extract seasonalities.</span>
<span class="sd">        value_column (str): name of the column with the values to analyse</span>
<span class="sd">        time_column (str): name of the column used to extract seasonalities and trends.</span>
<span class="sd">        model (str):       one of &#39;additive&#39; or &#39;multiplicative&#39;. Default is &#39;multiplicative&#39;</span>
<span class="sd">        show_autocorrelation_plot (bool): True if an autocorrelation plot wants to be displayed. Default is True</span>
<span class="sd">        lags_for_acf (int): number of lags to consider in the autocorrelation plot. Default is 365 * 2</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_orig</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">time_column</span><span class="p">,</span> <span class="n">value_column</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_orig</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">],</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">analysis</span> <span class="o">=</span> <span class="n">data_orig</span><span class="p">[</span><span class="n">value_column</span><span class="p">]</span>

    <span class="n">decompose_result_mult</span> <span class="o">=</span> <span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">analysis</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>
    <span class="n">trend</span> <span class="o">=</span> <span class="n">decompose_result_mult</span><span class="o">.</span><span class="n">trend</span>
    <span class="n">seasonal</span> <span class="o">=</span> <span class="n">decompose_result_mult</span><span class="o">.</span><span class="n">seasonal</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">decompose_result_mult</span><span class="o">.</span><span class="n">resid</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span>
        <span class="n">rows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">cols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">vertical_spacing</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
        <span class="n">horizontal_spacing</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
        <span class="n">row_heights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
        <span class="n">subplot_titles</span><span class="o">=</span><span class="p">([</span><span class="s2">&quot;Original set and Trend&quot;</span><span class="p">,</span> <span class="s2">&quot;Seasonal&quot;</span><span class="p">,</span> <span class="s2">&quot;Residual&quot;</span><span class="p">]),</span>
        <span class="n">shared_xaxes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">specs</span><span class="o">=</span><span class="p">[[{}],</span> <span class="p">[{}],</span> <span class="p">[{</span><span class="s2">&quot;secondary_y&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}]],</span>
    <span class="p">)</span>

    <span class="c1"># Original</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scattergl</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">time_column</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">value_column</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Original&quot;</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;rgba(30,125,245,.5)&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Trend</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scattergl</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">analysis</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">trend</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Trend&quot;</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Seasonal</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scattergl</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">analysis</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">seasonal</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Seasonal&quot;</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Residual</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scattergl</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">analysis</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Residual&quot;</span><span class="p">,</span>
            <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">row</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">secondary_y</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1400</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_autocorrelation_plot</span><span class="p">:</span>
        <span class="n">my_dpi</span> <span class="o">=</span> <span class="mi">96</span>
        <span class="n">fig_plt</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">1400</span> <span class="o">/</span> <span class="n">my_dpi</span><span class="p">,</span> <span class="mi">200</span> <span class="o">/</span> <span class="n">my_dpi</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="n">my_dpi</span><span class="p">)</span>
        <span class="n">plot_acf</span><span class="p">(</span><span class="n">analysis</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags_for_acf</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">fig_plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>

<h2 id="pareto">Pareto</h2>
<div class="codehilite"><pre><span></span><code><span class="k">def</span> <span class="nf">plot_pareto</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">categorical_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value_column</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">threshold_on_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Plot Pareto&#39;s curve and compare to the usual 80/20 principle</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): dataframe with at least a categorical and a value column</span>
<span class="sd">        categorical_column (str): name of the categorical column to consider.</span>
<span class="sd">        value_column (str): name of the values column</span>
<span class="sd">        threshold_on_value (float, optional): cutoff at which categorical entities will be grouped under a unique group.</span>
<span class="sd">            If None, all elements are shown independently. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        go.Figure: Pareto plot</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;n_elements&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;elem_group&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="n">categorical_column</span><span class="p">]</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">value_column</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold_on_value</span> <span class="k">else</span> <span class="s2">&quot;below_threshold&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
    <span class="p">)</span>

    <span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;elem_group&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="n">value_column</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="s2">&quot;n_elements&quot;</span><span class="p">:</span> <span class="s2">&quot;sum&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">value_column</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">is_below_thr</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;elem_group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;below_threshold&quot;</span>
    <span class="n">df_grouped</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_grouped</span><span class="p">[</span><span class="o">~</span><span class="n">is_below_thr</span><span class="p">],</span> <span class="n">df_grouped</span><span class="p">[</span><span class="n">is_below_thr</span><span class="p">]])</span>

    <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;cumulative_pct_val&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">df_grouped</span><span class="p">[</span><span class="n">value_column</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df_grouped</span><span class="p">[</span><span class="n">value_column</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;cat_order_per_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;n_elements&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
    <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;cum_pct_categories&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;cat_order_per_value&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;n_elements&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">fig</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">specs</span><span class="o">=</span><span class="p">[[{</span><span class="s2">&quot;secondary_y&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}]])</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;cum_pct_categories&quot;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;cumulative_pct_val&quot;</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;cumulative % of </span><span class="si">{</span><span class="n">value_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines+markers&quot;</span><span class="p">,</span>
            <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;rgba(255,0,0,.5)&quot;</span><span class="p">,</span>
            <span class="n">customdata</span><span class="o">=</span><span class="n">df_grouped</span><span class="p">[[</span><span class="s2">&quot;elem_group&quot;</span><span class="p">,</span> <span class="s2">&quot;n_elements&quot;</span><span class="p">,</span> <span class="n">value_column</span><span class="p">]],</span>
            <span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;&lt;br&gt;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="s2">&quot;&lt;b&gt;%</span><span class="si">{y:0.2f}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Element: &lt;b&gt;%</span><span class="si">{customdata[0]}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Value: &lt;b&gt;%</span><span class="si">{customdata[2]:,}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;Cumulative </span><span class="si">% c</span><span class="s2">ategories: &lt;b&gt;%</span><span class="si">{x}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span>

                    <span class="s2">&quot;n_elements: &lt;b&gt;%</span><span class="si">{customdata[1]}</span><span class="s2">&lt;/b&gt;&quot;</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
        <span class="p">),</span>
        <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;cum_pct_categories&quot;</span><span class="p">],</span>
            <span class="n">y</span><span class="o">=</span><span class="n">df_grouped</span><span class="p">[</span><span class="n">value_column</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="n">value_column</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,255,.5)&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,.3)&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">),</span> <span class="n">secondary_y</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_vline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;rgba(0,0,0,.3)&quot;</span><span class="p">,</span> <span class="n">dash</span><span class="o">=</span><span class="s2">&quot;dash&quot;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;x unified&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Pareto chart of </span><span class="si">{</span><span class="n">value_column</span><span class="si">}</span><span class="s2"> per </span><span class="si">{</span><span class="n">categorical_column</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1600</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div>

<hr />
<h1 id="maps">Maps</h1>
<hr />
<h1 id="other-resources">Other resources</h1>
<p>There's a plethora of tips, guidelines and tutorials about MLOps, Data Science, Visualizations and Analysis out there.
Some of my personal favourites are:
* <a href="https://madewithml.com/">MadeWithML by Goku Mohandas</a>
* <a href="https://khuyentran1401.github.io/reproducible-data-science/README.html">Kuhyen Tran's tips</a>
* <a href="https://geographicdata.science/book/intro.html">Geographic Data Science by Sergio Rey, Dani Arribas and Levi Wolf</a>
* <a href="https://jakevdp.github.io/PythonDataScienceHandbook/">Python Data Science Handbook by Jake VanderPlas</a></p>
                                        </div>

                                   </div>
                              </div>
                         </div>
               </section>

               <!-- Footer Section -->

               <footer id="app-footer"></footer>
               <script async src="../../js/footer.js"></script>

               <!-- Back top -->
               <a href="#back-top" class="go-top"><i class="fa fa-angle-up"></i></a>

               <!-- SCRIPTS -->
               <script src="./js/jquery.js"></script>
               <script src="./js/bootstrap.min.js"></script>
               <script src="./js/jquery.parallax.js"></script>
               <script src="./js/custom.js"></script>
               <script type="module" src="https://md-block.verou.me/md-block.js"></script>

          </body>

          </html>
          